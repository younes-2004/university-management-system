<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Carte Étudiant - Système Universitaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/custom.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold">Système Universitaire</h1>
            <div class="flex items-center space-x-4">
                <span id="user-info">Chargement...</span>
                <div class="relative group">
                    <button class="bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded flex items-center">
                        <span>Menu</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden group-hover:block z-10">
                        <div class="py-1">
                            <a href="../profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Mon profil</a>
                            <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Déconnexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow">
        <div class="container mx-auto px-4 py-3">
            <div class="flex space-x-4">
                <a href="dashboard.html" class="text-gray-700 hover:bg-gray-100 px-3 py-2 rounded font-medium">Tableau de bord</a>
                <a href="card-request.html" class="bg-blue-100 text-blue-700 px-3 py-2 rounded font-medium">Ma carte</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <div class="max-w-3xl mx-auto">
            <!-- Statut actuel de la carte -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-semibold">Ma Carte Étudiant</h2>
                </div>
                <div class="p-6">
                    <div id="card-status-container" class="animate-pulse bg-gray-200 h-20 rounded"></div>
                    <div id="card-action-container" class="mt-4"></div>
                </div>
            </div>

            <!-- Historique des demandes -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="bg-blue-600 text-white p-4">
                    <h2 class="text-xl font-semibold">Historique des demandes</h2>
                </div>
                <div class="p-6">
                    <div id="card-history" class="animate-pulse bg-gray-200 h-40 rounded"></div>
                </div>
            </div>

            <!-- Card preview (visual representation) -->
            <div id="card-preview" class="mt-6 hidden">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="bg-blue-600 text-white p-4">
                        <h2 class="text-xl font-semibold">Aperçu de la carte</h2>
                    </div>
                    <div class="p-6">
                        <div class="max-w-md mx-auto bg-gradient-to-r from-blue-800 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="text-xl font-bold">Carte Étudiant</h3>
                                    <p class="text-sm text-blue-200">Université</p>
                                </div>
                                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                                    <span class="text-blue-600 font-bold text-sm">LOGO</span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="text-sm text-blue-200">Nom complet</div>
                                <div class="font-medium" id="card-name">Chargement...</div>
                            </div>
                            <div class="mt-2">
                                <div class="text-sm text-blue-200">Numéro Apogée</div>
                                <div class="font-medium" id="card-apogee">Chargement...</div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <div>
                                    <div class="text-sm text-blue-200">Filière</div>
                                    <div class="font-medium" id="card-filiere">Chargement...</div>
                                </div>
                                <div>
                                    <div class="text-sm text-blue-200">Année</div>
                                    <div class="font-medium" id="card-annee">Chargement...</div>
                                </div>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <div class="text-sm text-blue-200">Année universitaire 2024-2025</div>
                                <div class="text-xs border border-white px-2 py-1 rounded" id="card-status">Valide</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="../js/auth.js"></script>
    <script src="../js/common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si l'utilisateur est authentifié
            const user = checkAuth();
            if (!user) return;
            
            // Vérifier si l'utilisateur est bien un étudiant
            if (user.role !== 'STUDENT') {
                logout();
                return;
            }
            
            // Afficher les informations de l'utilisateur
            document.getElementById('user-info').textContent = `${user.prenom} ${user.nom}`;
            
            // Charger les informations de l'étudiant pour l'aperçu de la carte
            loadStudentInfo();
            
            // Charger le statut actuel de la carte
            loadCardStatus();
            
            // Charger l'historique des demandes
            loadCardHistory();
        });

        // Charger les informations de l'étudiant
        async function loadStudentInfo() {
            try {
                const data = await apiGet('http://localhost:8080/api/auth/profile');
                
                if (data) {
                    // Mettre à jour l'aperçu de la carte
                    document.getElementById('card-name').textContent = `${data.prenom} ${data.nom}`;
                    document.getElementById('card-apogee').textContent = data.nApogee || 'N/A';
                    document.getElementById('card-annee').textContent = data.annee === 'PREMIERE_ANNEE' ? '1ère année' : '2ème année';
                    
                    // Charger le nom de la filière si l'ID est disponible
                    if (data.filiereId) {
                        loadFiliereName(data.filiereId);
                    } else {
                        document.getElementById('card-filiere').textContent = 'Non affectée';
                    }
                }
            } catch (error) {
                console.error('Erreur lors du chargement des informations:', error);
            }
        }

        // Charger le nom de la filière
        async function loadFiliereName(filiereId) {
            try {
                const data = await apiGet(`http://localhost:8080/api/filieres/${filiereId}`);
                if (data) {
                    document.getElementById('card-filiere').textContent = data.nom;
                }
            } catch (error) {
                document.getElementById('card-filiere').textContent = 'Non disponible';
            }
        }

        // Charger le statut de la carte
        async function loadCardStatus() {
            try {
                const requests = await apiGet('http://localhost:8080/api/student/card-requests');
                const cardStatusContainer = document.getElementById('card-status-container');
                const cardActionContainer = document.getElementById('card-action-container');
                const cardPreview = document.getElementById('card-preview');
                
                if (!requests || requests.length === 0) {
                    // Aucune demande de carte
                    cardStatusContainer.innerHTML = `
                        <div class="p-4 border-l-4 border-yellow-400 bg-yellow-50">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        Vous n'avez pas encore de carte étudiant. Veuillez faire une demande.
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    cardActionContainer.innerHTML = `
                        <button onclick="requestCard()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
                            </svg>
                            Demander une carte
                        </button>
                    `;
                    cardPreview.classList.add('hidden');
                } else {
                    // Dernière demande (la plus récente)
                    const latestRequest = requests[0];
                    
                    // Afficher le statut
                    switch (latestRequest.status) {
                        case 'PENDING':
                            cardStatusContainer.innerHTML = `
                                <div class="p-4 border-l-4 border-yellow-400 bg-yellow-50">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-yellow-700">
                                                <span class="font-medium">En attente :</span> Votre demande de carte est en cours de traitement.
                                            </p>
                                            <p class="mt-2 text-xs text-yellow-600">
                                                Demande soumise le ${formatDate(latestRequest.requestDate)}
                                            </p>
                                            <p class="mt-1 text-xs text-yellow-600">
                                                Veuillez patienter pendant que l'administration traite votre demande.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            cardActionContainer.innerHTML = '';
                            cardPreview.classList.add('hidden');
                            break;
                            
                        case 'APPROVED':
                            cardStatusContainer.innerHTML = `
                                <div class="p-4 border-l-4 border-green-400 bg-green-50">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-green-700">
                                                <span class="font-medium">Approuvée :</span> Votre demande de carte a été approuvée.
                                            </p>
                                            <p class="mt-2 text-xs text-green-600">
                                                Approuvée le ${formatDate(latestRequest.processedDate)}
                                            </p>
                                            <p class="mt-1 text-xs text-green-600">
                                                Veuillez récupérer votre carte au bureau des cartes étudiantes.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            cardActionContainer.innerHTML = `
                                <button onclick="confirmCardReception(${latestRequest.id})" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                    </svg>
                                    Confirmer la réception
                                </button>
                            `;
                            cardPreview.classList.remove('hidden');
                            document.getElementById('card-status').textContent = 'En attente de récupération';
                            break;
                            
                        case 'REJECTED':
                            cardStatusContainer.innerHTML = `
                                <div class="p-4 border-l-4 border-red-400 bg-red-50">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-red-700">
                                                <span class="font-medium">Rejetée :</span> Votre demande de carte a été rejetée.
                                            </p>
                                            <p class="mt-2 text-xs text-red-600">
                                                Rejetée le ${formatDate(latestRequest.processedDate)}
                                            </p>
                                            <p class="mt-1 text-xs text-red-600">
                                                Veuillez contacter l'administration pour plus d'informations ou faire une nouvelle demande.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            cardActionContainer.innerHTML = `
                                <button onclick="requestCard()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                                    </svg>
                                    Faire une nouvelle demande
                                </button>
                            `;
                            cardPreview.classList.add('hidden');
                            break;
                            
                        case 'RECEIVED':
                            cardStatusContainer.innerHTML = `
                                <div class="p-4 border-l-4 border-blue-400 bg-blue-50">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm text-blue-700">
                                                <span class="font-medium">Carte active :</span> Vous avez récupéré votre carte étudiant.
                                            </p>
                                            <p class="mt-2 text-xs text-blue-600">
                                                Carte récupérée le ${formatDate(latestRequest.receivedDate)}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                            cardActionContainer.innerHTML = '';
                            cardPreview.classList.remove('hidden');
                            document.getElementById('card-status').textContent = 'Valide';
                            break;
                            
                        default:
                            cardStatusContainer.innerHTML = `<p>Statut inconnu</p>`;
                            cardActionContainer.innerHTML = '';
                            cardPreview.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Erreur lors du chargement du statut de la carte:', error);
                document.getElementById('card-status-container').innerHTML = `
                    <div class="p-4 border-l-4 border-red-400 bg-red-50">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-red-700">
                                    Erreur lors du chargement du statut de la carte
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Charger l'historique des demandes
        async function loadCardHistory() {
            try {
                const requests = await apiGet('http://localhost:8080/api/student/card-requests');
                const historyDiv = document.getElementById('card-history');
                
                if (!requests || requests.length === 0) {
                    historyDiv.innerHTML = `<p class="text-gray-500">Aucun historique de demande disponible.</p>`;
                    return;
                }
                
                historyDiv.innerHTML = `
                    <div class="relative">
                        <div class="absolute left-4 inset-0 w-px bg-gray-200"></div>
                        <ul class="relative">
                            ${requests.map((request, index) => {
                                // Déterminer l'icône en fonction du statut
                                let icon = '';
                                let bgColor = '';
                                
                                switch (request.status) {
                                    case 'PENDING':
                                        icon = '<svg class="h-5 w-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>';
                                        bgColor = 'bg-yellow-100';
                                        break;
                                    case 'APPROVED':
                                        icon = '<svg class="h-5 w-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
                                        bgColor = 'bg-green-100';
                                        break;
                                    case 'REJECTED':
                                        icon = '<svg class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>';
                                        bgColor = 'bg-red-100';
                                        break;
                                    case 'RECEIVED':
                                        icon = '<svg class="h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
                                        bgColor = 'bg-blue-100';
                                        break;
                                    default:
                                        icon = '<svg class="h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>';
                                        bgColor = 'bg-gray-100';
                                }
                                
                                return `
                                    <li class="mb-6 ${index === requests.length - 1 ? 'pb-0' : ''}">
                                        <div class="flex items-start">
                                            <div class="flex flex-col items-center">
                                                <span class="flex items-center justify-center w-8 h-8 rounded-full ${bgColor} mr-3">
                                                    ${icon}
                                                </span>
                                                <div class="w-px h-full bg-gray-300"></div>
                                            </div>
                                            <div class="pt-1">
                                                <p class="font-medium">
                                                    ${getStatusLabel(request.status)}
                                                </p>
                                                <p class="text-sm text-gray-500 mt-1">
                                                    Demande soumise le ${formatDate(request.requestDate)}
                                                </p>
                                                ${request.processedDate ? `
                                                    <p class="text-xs text-gray-500 mt-1">
                                                        Traitée le ${formatDate(request.processedDate)} 
                                                        ${request.processedByName ? `par ${request.processedByName}` : ''}
                                                    </p>
                                                ` : ''}
                                                ${request.receivedDate ? `
                                                    <p class="text-xs text-gray-500 mt-1">
                                                        Récupérée le ${formatDate(request.receivedDate)}
                                                    </p>
                                                ` : ''}
                                            </div>
                                        </div>
                                    </li>
                                `;
                            }).join('')}
                        </ul>
                    </div>
                `;
            } catch (error) {
                console.error('Erreur lors du chargement de l\'historique de demandes:', error);
                document.getElementById('card-history').innerHTML = `
                    <p class="text-red-600">Erreur lors du chargement de l'historique des demandes</p>
                `;
            }
        }

        // Demander une carte
        async function requestCard() {
            try {
                const result = await apiPost('http://localhost:8080/api/student/card-requests', {});
                
                if (result) {
                    showNotification('Demande de carte envoyée avec succès');
                    // Recharger le statut et l'historique
                    loadCardStatus();
                    loadCardHistory();
                }
            } catch (error) {
                console.error('Erreur lors de la demande de carte:', error);
                showNotification('Erreur lors de la demande de carte', 'error');
            }
        }

        // Confirmer la réception de la carte
        async function confirmCardReception(requestId) {
            try {
                const result = await apiPut(`http://localhost:8080/api/student/card-requests/${requestId}/confirm-reception`, {});
                
                if (result) {
                    showNotification('Réception de la carte confirmée avec succès');
                    // Recharger le statut et l'historique
                    loadCardStatus();
                    loadCardHistory();
                }
            } catch (error) {
                console.error('Erreur lors de la confirmation de réception:', error);
                showNotification('Erreur lors de la confirmation de réception', 'error');
            }
        }

        // Obtenir le libellé du statut de demande
        function getStatusLabel(status) {
            switch (status) {
                case 'PENDING':
                    return 'Demande en attente';
                case 'APPROVED':
                    return 'Demande approuvée';
                case 'REJECTED':
                    return 'Demande rejetée';
                case 'RECEIVED':
                    return 'Carte récupérée';
                default:
                    return 'Statut inconnu';
            }
        }
    </script>
</body>
</html>